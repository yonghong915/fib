<?xml version="1.0" encoding="UTF-8" ?>
<message-bean-mapping id="BEPS_128MappingOut" source-type="message-bean" target-type="map">
	<mapping type="value" to="serviceId">receivePaymentStatusReport</mapping>
	<mapping type="value" to="communicationEventTypeId">MESSAGE_IN_COMM</mapping>
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="contentMimeTypeId"></mapping><!-- 报文类型代码 例如：beps.008.001.01-->
	<mapping type="value" to="prodCatalogId">BEPS</mapping><!--接收系统号-->	
		
		<!--验签结果-->
	<mapping type="value-mapping" from="checkEscortFlag" to="checkEscortFlag"/> <!--核押验签结果 -->
    <!-- 报文头 begin -->
	<!-- 报文头 begin -->
	<mapping type="value-mapping" from="MsgHeader.BeginFlag" to="BeginFlag"></mapping><!-- 开始标识 -->
	<mapping type="value-mapping" from="MsgHeader.VersionID" to="VersionID" ></mapping><!--版本 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSender" to="extendMap.origSender"></mapping><!--报文发起人 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSender" to="instructingParty"></mapping><!--发起参与机构-->
	<mapping type="value-mapping" from="MsgHeader.OrigSenderSID" to="extendMap.origSenderSID"></mapping><!--发送系统号 -->
	<mapping type="value-mapping" from="MsgHeader.OrigReceiver" to="extendMap.origReceiver"></mapping><!--报文接收人 -->
	<mapping type="value-mapping" from="MsgHeader.OrigReceiver" to="instructedParty"></mapping><!--接收参与机构 -->
	<mapping type="value-mapping" from="MsgHeader.OrigReceiverSID" to="extendMap.origReceiverSID"></mapping><!--接收系统号 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSendDate" to="extendMap.origSendDate"></mapping><!--报文发起日期 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSendTime" to="OrigSendTime"></mapping><!--报文发起时间-->
	<mapping type="value-mapping" from="MsgHeader.StructType" to="StructType"></mapping><!-- 格式类型 -->
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="responseMessageTypeId"></mapping><!-- 报文类型代码 -->
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="contentMimeTypeId"></mapping><!-- 报文类型代码 -->
	<mapping type="value-mapping" from="MsgHeader.MesgID" to="extendMap.mesgID"></mapping><!-- 通信级标识号 -->
	<mapping type="value-mapping" from="MsgHeader.MesgRefID" to="extendMap.mesgRefID"></mapping>
	<mapping type="value-mapping" from="MsgHeader.MesgPriority" to="MesgPriority"></mapping>
	<mapping type="value-mapping" from="MsgHeader.MesgDirection" to="MesgDirection"></mapping>
    <mapping type="value-mapping" from="MsgHeader.Reserve" to="Reserve"></mapping>
	<mapping type="value-mapping" from="MsgHeader.EndFlag" to="EndFlag"></mapping><!-- 结束标识 -->
    <!-- 报文头 end-->


	<!-- 报文体内容 -->
	<!-- 报文正文其他信息 -->

	<mapping type="value-mapping" from="BEPS_128_Out.MessageIdentification" to="responseMessageId"/><!-- 报文标识号 -->

	<mapping type="value-mapping" from="BEPS_128_Out.CreationDateTime" to="CreationDateTime"/><!-- 报文发送时间 -->

	<mapping type="value-mapping" from="BEPS_128_Out.OriginalMessageIdentification" to="messageIdentification"></mapping><!-- 原报文标识号 -->
	<mapping type="value-mapping" from="BEPS_128_Out.OriginalMessageNameIdentification" to="messageTypeId"/><!-- 原报文类型代码 -->
	<mapping type="value-mapping" from="BEPS_128_Out.OriginalNumberOfTransactions" to="successNumber"/><!-- 回执明细业务成功总笔数 -->
	<mapping type="value-mapping" from="BEPS_128_Out.OriginalControlSum" to="successTotal"/><!-- 回执明细业务成功总金额 -->


	<mapping type="value-mapping" from="BEPS_128_Out.DetailedNumberOfTransactions" to="itemNumber"/><!-- 回执明细业务总笔数 -->
	<mapping type="value-mapping" from="BEPS_128_Out.DetailedStatus" to="DetailedStatus"></mapping><!-- DetailedStatus -->
	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].StatusIdentification" to="transactionStatusList[].responseProcessCode"/><!--  业务回执状态 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].OriginalTransactionIdentification" to="transactionStatusList[].transactionId"></mapping><!--  原明细标识号 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Proprietary" to="transactionStatusList[].rejectCode"/><!-- 业务拒绝处理码 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].AdditionalInformation5" to="transactionStatusList[].rejectReason"/><!-- 业务拒绝原因 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].InterbankSettlementAmount" to="transactionStatusList[].settlementAmount"/><!-- 原货币符号、结算金额 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Proprietary2" to="transactionStatusList[].categoryPurpose"/><!-- 原业务类型编码 -->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].MemberIdentification" to="transactionStatusList[].originalCreditorClearingBranch"/><!-- 原收款清算行行号-->

	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Identification" to="transactionStatusList[].originalCreditorBranch"/><!-- 原收款行行号 -->

	<!--mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Unstructured" to="transactionStatusList[].Unstructured"/--><!-- 附言 -->
	<!--mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Unstructured2" to="transactionStatusList[].Unstructured2"/--><!-- 代理行手续费 -->
	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].MemberIdentification2" to="transactionStatusList[].debtorClearingBranch"/><!-- 付款清算行行号-->
	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Identification2" to="transactionStatusList[].debtorBranch"/><!-- 付款行行号 -->
	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].MemberIdentification3" to="transactionStatusList[].creditorClearingBranch"/><!-- 收款清算行行号 -->
	<mapping type="value-mapping" from="BEPS_128_Out.TransactionInformationAndStatus[].Identification3" to="transactionStatusList[].creditorBranch"/><!-- 收款行行号 -->
	<manual-mapping> <![CDATA[
		import java.util.Map;
		import java.util.ArrayList;
		import java.util.List;
		import java.util.HashMap;
		import com.giantstone.cnaps2.messagebean.recv.req.*;
		// NPC处理信息
		List ccti = sourceBean.BEPS_128_Out.beps;
		for(BEPS_128_OutBeps beps128Ccti : ccti){

			String value = beps128Ccti.AdditionalInformation;
			String name = "";
			if(value.contains("F61")){//包处理状态
				name="processStatus";
			}else if(value.contains("C01")){//NPC轧差日期
				name="nettingDate";
			}else if(value.contains("E05")){// NPC轧差场次
				name="nettingRound";
			}else if(value.contains("C00")){//NPC清算日期/终态日期
				name="settlementDate";
			}

			if(!name.equals("")){
				value = value.substring(5);
				target.put(name,value);
			}

		}
		// 明细List
		List transactionStatusList = target.get("transactionStatusList");
		// 明细信息集
		List TransactionInformationAndStatus = sourceBean.BEPS_128_Out.TransactionInformationAndStatus;
		for(int i=0;i<transactionStatusList.size();i++) {
			BEPS_128_OutTransactionInformationAndStatus bean = TransactionInformationAndStatus.get(i);
			Map transactionStatusListMap = transactionStatusList.get(i);
			List bepsUstrd = bean.bepsUstrd;//包括两个字段，一、附言;二、代理行手续费（需加入验签要素串）

			for(BEPS_128_OutTransactionInformationAndStatusBepsUstrd bU : bepsUstrd){
				String name = "";
				String value = bU.getUnstructured();
				if(value.contains("H01")){//附言
					name="Unstructured";
				}else if(value.contains("D14")){//代理行手续费
					name="Unstructured2";
				}

				if(!name.equals("")){
					value = value.substring(5);
					transactionStatusListMap.put(name,value);
				}
			}
		}
		]]>
		</manual-mapping>
  </message-bean-mapping>
