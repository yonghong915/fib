<?xml version="1.0" encoding="UTF-8" ?>
<message-bean-mapping id="BEPS_130MappingOut" source-type="message-bean" target-type="map">
	<!-- 接收服务 -->
	<mapping type="value" to="serviceId">PECISReceiveRevertService</mapping>
	<!-- 通道类型 -->
	<mapping type="value" to="prodCatalogId">BEPS</mapping>
	<!-- 类型 -->
	<mapping type="value" to="systemCode">BEPS</mapping>
	<!-- 交流事件类型 -->
	<mapping type="value" to="communicationEventTypeId">MESSAGE_IN_COMM</mapping>
	<!-- 源地址 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSender" to="partyIdFrom" />
	<!-- 原报文标识号 -->
	<mapping type="value" to="messageIdentification" >99999999</mapping>
	<!-- 原报文类型 -->
	<mapping type="value" to="messageTypeId" >999</mapping>
		<!--验签结果-->
	<mapping type="value-mapping" from="checkEscortFlag" to="checkEscortFlag"/> <!--核押验签结果 -->
	<!-- ********************* 报文头 *********************  -->
	<!-- <mapping type="value-mapping" from="MsgHeader.BeginFlag" to="BeginFlag" />开始标识 -->
	<!-- <mapping type="value-mapping" from="MsgHeader.VersionID" to="VersionID"  />版本 -->
	<!--报文发起人 -->
	<mapping type="value-mapping" from="MsgHeader.OrigReceiver" to="extendMap.origSender" />
	<mapping type="value-mapping" from="MsgHeader.OrigReceiver" to="instructedParty" />
	<!--发送系统号 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSenderSID" to="extendMap.origSenderSID" />
	<!--报文接收人 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSender" to="extendMap.origReceiver" />	   
	<mapping type="value-mapping" from="MsgHeader.OrigSender" to="instructingParty" />
	<!-- 接收系统号 -->
	<mapping type="value-mapping" from="MsgHeader.OrigReceiverSID" to="extendMap.origReceiverSID" />
	<!-- 报文发起日期 -->
	<mapping type="value-mapping" from="MsgHeader.OrigSendDate" to="extendMap.origSendDate" />
	<!-- 通信级标识号 -->
	<mapping type="value-mapping" from="MsgHeader.MesgID" to="extendMap.mesgID" />
	<!-- 通信级参考标识号 -->
	<mapping type="value-mapping" from="MsgHeader.MesgRefID" to="extendMap.mesgRefID" />
	<!-- 回执报文类型代码 -->
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="contentMimeTypeId" />
	<!-- 回执报文类型 -->
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="contentMimeTypeId" />
	<mapping type="value-mapping" from="MsgHeader.MesgType" to="responseMessageTypeId" />
	<!-- 报文发起时间-->
	<mapping type="value-mapping" from="MsgHeader.OrigSendDate" to="entrustDate" />
	<!-- <mapping type="value-mapping" from="MsgHeader.StructType" to="StructType" />格式类型 -->
	<!-- <mapping type="value-mapping" from="MsgHeader.MesgPriority" to="MesgPriority" /> -->
	<!-- <mapping type="value-mapping" from="MsgHeader.MesgDirection" to="MesgDirection" /> -->
	<!-- <mapping type="value-mapping" from="MsgHeader.Reserve" to="Reserve" /> -->
	<!-- <mapping type="value-mapping" from="MsgHeader.EndFlag" to="EndFlag" />结束标识 -->

	<!-- ********************* 报文体内容 ********************* -->
	<!-- 回执报文标识号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.MessageIdentification"	to="responseMessageId" />
	<mapping type="value-mapping" from="BEPS_130_Out.MessageIdentification"	to="subject" />
	<!-- 回执明细业务成功总笔数 -->
	<mapping type="value-mapping" from="BEPS_130_Out.NumberOfTransactions"	to="successNumber" />
	<!-- 回执明细业务成功总金额 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ControlSum" to="successTotal" />
	<!-- 回执明细总笔数 -->
	<mapping type="value-mapping" from="BEPS_130_Out.Proprietary"	to="itemNumber" />
	<!-- <mapping type="value-mapping" from="BEPS_130_Out.CreationDateTime" to="CreationDateTime" />报文发送时间 -->
	<!-- <mapping type="value-mapping" from="BEPS_130_Out.SettlementMethod" to="SettlementMethod" /> -->

	<!-- ********************* 交易明细信息 ************************** -->
	<!-- 端到端标识号 -->
	<!-- <mapping type="value-mapping" from="BEPS_130_Out.ccti[].EndToEndIdentification" to="transactionStatusList[].EndToEndIdentification" /> -->
	<!-- 明细标识号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].TransactionIdentification" to="transactionStatusList[].transactionSeq" />
	<!-- 业务类型编码 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Proprietary2" to="transactionStatusList[].operationType" />
	<!-- 结算金额 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].InterbankSettlementAmount" to="transactionStatusList[].transactionSum" />
	<!-- <mapping type="value-mapping" from="BEPS_130_Out.ccti[].ChargeBearer" to="transactionStatusList[].ChargeBearer"  />ChargeBearer -->
	<!-- 付款清算行行号 -->
	<!-- <mapping type="value-mapping" from="BEPS_130_Out.ccti[].MemberIdentification" to="transactionStatusList[].launchLiquidationBankNo" /> -->
	<!-- 付款行行号：业务发起行 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Identification" to="transactionStatusList[].launchBankNo" />
	<!-- 收款清算行行号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].MemberIdentification2" to="transactionStatusList[].receiveLiquidationBankNo" />
	<!--  收款行行号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Identification2" to="transactionStatusList[].receiveBankNo" />
	<!-- 付款人名称 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Name" to="transactionStatusList[].draweeAccName" />
	<!-- 付款人地址 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].AddressLine" to="transactionStatusList[].draweeAddress" />
	<!-- 付款人账号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Identification3" to="transactionStatusList[].draweeAccNo" />
	<!-- 付款人开户行行号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].MemberIdentification3" to="transactionStatusList[].draweeBankCode" />
	<!-- 付款人开户行名称 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Name2" to="transactionStatusList[].draweeBankName" />
	<!-- 收款人开户行行号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].MemberIdentification4" to="transactionStatusList[].payeeBankCode" />
	<!-- 收款人开户行名称 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Name3" to="transactionStatusList[].payeeBankName" />
	<!--收款人名称-->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Name4" to="transactionStatusList[].payeeAccName" />
	<!-- 收款人地址 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].AddressLine2" to="transactionStatusList[].payeeAccAddress" />
	<!-- 收款人账号 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Identification4" to="transactionStatusList[].payeeAccNo" />
	<!-- 业务种类编码 -->
	<mapping type="value-mapping" from="BEPS_130_Out.ccti[].Proprietary3" to="transactionStatusList[].operationCategory" />
	<!--  附言 -->
	<!--  
	<mapping type="script" to="transactionStatusList[].Unstructured">
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured = map.get("Unstructured");
					if(Unstructured != null&&Unstructured.length() > 5){
						Unstructured = Unstructured.substring(5);
						map.put("Unstructured",Unstructured);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--  附言2 -->
	<!--  
	<mapping type="script" to="transactionStatusList[].Unstructured2">
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured2 = map.get("Unstructured2");
					if(Unstructured2 != null&&Unstructured2.length() > 5){
						Unstructured2 = Unstructured2.substring(5);
						map.put("Unstructured2",Unstructured2);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--  备注 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured3" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured3 = map.get("Unstructured3");
					if(Unstructured3 != null&&Unstructured3.length() > 5){
						Unstructured3 = Unstructured3.substring(5);
						map.put("Unstructured3",Unstructured3);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--   备注2 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured4" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured4 = map.get("Unstructured4");
					if(Unstructured4 != null&&Unstructured4.length() > 5){
						Unstructured4 = Unstructured4.substring(5);
						map.put("Unstructured4",Unstructured4);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--  原CIS委托日期 -->
	<!--
	<mapping type="script" to="transactionStatusList[].originalEntrustDate" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured5 = map.get("Unstructured5");
					if(Unstructured5 != null&&Unstructured5.length() > 5){
						Unstructured5 = Unstructured5.substring(5);
						map.put("originalEntrustDate",Unstructured5);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- 原CIS交易序号 -->
	<!--
	<mapping type="script" to="transactionStatusList[].originalTransactionSeq" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured6 = map.get("Unstructured6");
					if(Unstructured6 != null&&Unstructured6.length() > 5){
						Unstructured6 = Unstructured6.substring(5);
						map.put("Unstructured6",Unstructured6);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- 原CIS票据号码 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured7" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured7 = map.get("Unstructured7");
					if(Unstructured7 != null&&Unstructured7.length() > 5){
						Unstructured7 = Unstructured7.substring(5);
						map.put("Unstructured7",Unstructured7);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- 回执状态 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured8" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured8 = map.get("Unstructured8");
					if(Unstructured8 != null&&Unstructured8.length() > 5){
						Unstructured8 = Unstructured8.substring(5);
						map.put("Unstructured8",Unstructured8);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- 业务拒绝处理码 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured9">
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured9 = map.get("Unstructured9");
					if(Unstructured9 != null&&Unstructured9.length() > 5){
						Unstructured9 = Unstructured9.substring(5);
						map.put("Unstructured9",Unstructured9);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- 业务拒绝信息 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured10" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured10 = map.get("Unstructured10");
					if(Unstructured10 != null&&Unstructured10.length() > 5){
						Unstructured10 = Unstructured10.substring(5);
						map.put("Unstructured10",Unstructured10);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- NPC处理状态-->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured11" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured11 = map.get("Unstructured11");
					if(Unstructured11 != null&&Unstructured11.length() > 5){
						Unstructured11 = Unstructured11.substring(5);
						map.put("Unstructured11",Unstructured11);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!-- NPC轧差日期 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured12" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured12 = map.get("Unstructured12");
					if(Unstructured12 != null&&Unstructured12.length() > 5){
						Unstructured12 = Unstructured12.substring(5);
						map.put("Unstructured12",Unstructured12);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--  NPC轧差场次 -->
	<!-- 
	<mapping type="script" to="transactionStatusList[].Unstructured13" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured13 = map.get("Unstructured13");
					if(Unstructured13 != null&&Unstructured13.length() > 5){
						Unstructured13 = Unstructured13.substring(5);
						map.put("Unstructured13",Unstructured13);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<!--  NPC清算日期/终态日期 -->
	<!--
	<mapping type="script" to="transactionStatusList[].Unstructured14" >
	<![CDATA[
			import com.giantstone.cnaps2.messagebean.recv.req.BEPS_130_OutCcti;

			List beps = sourceBean.BEPS_130_Out.ccti;
			if(beps != null){
				for(int i = 0;i < beps.size();i++){
					Map map = (Map)beps.get(i);
					String Unstructured14 = map.get("Unstructured14");
					if(Unstructured14 != null&&Unstructured14.length() > 5){
						Unstructured14 = Unstructured14.substring(5);
						map.put("Unstructured14",Unstructured14);
						beps.set(i,map);
					}
				}
			}
			return beps;
	]]>
	</mapping>
	-->
	<manual-mapping>
	<![CDATA[
		import java.util.*;
		import com.giantstone.cnaps2.messagebean.recv.req.*;

		List beps = sourceBean.BEPS_130_Out.ccti;
		List transactionStatusList = (List) target.get("transactionStatusList");
		if(beps != null && transactionStatusList != null && transactionStatusList.size()>0){
			for(int i = 0;i < beps.size();i++){
				BEPS_130_OutCcti outCcti = (BEPS_130_OutCcti) beps.get(i);
				Map itemMap = (Map) transactionStatusList.get(i);

				List addInfos = outCcti.getAddInfos();
				for(BEPS_130_OutCctiAddInfos addInfo : addInfos){
					String value = addInfo.getUnstructured();
					// 附言
					if(value.startsWith("/H01/")){
						itemMap.put("postscript", value.substring(5));
					}
					// 附言2
					else if(value.startsWith("/H02/")){
						itemMap.put("summary",value.substring(5));
					}
					// 备注
					else if(value.startsWith("/HA1/")){
						itemMap.put("remark", value.substring(5));
					}
					// 备注2
					else if(value.startsWith("/HA2/")){
						itemMap.put("remark2", value.substring(5));
					}
					// 原CIS委托日期
					else if(value.startsWith("/C14/")){
						itemMap.put("originalEntrustDate", value.substring(5));
					}
					// 原CIS交易序号
					else if(value.startsWith("/EA2/")){
						itemMap.put("originalTransactionSeq", value.substring(5));
					}
					// 原CIS票据号码
					else if(value.startsWith("/E45/")){
						itemMap.put("billNo", value.substring(5));
					}
					// 回执状态
					else if(value.startsWith("/F60/")){
						itemMap.put("processCode", value.substring(5));
						// Modify by zhao_dl 20140509, 当包中有多笔业务时此状态会覆盖人行处理状态
						// target.put("processStatus",value.substring(5));
					}
					// 业务拒绝处理码
					else if(value.startsWith("/G00/")){
						itemMap.put("rejectCode", value.substring(5));
					}
					// 业务拒绝信息
					else if(value.startsWith("/H06/")){
						itemMap.put("rejectReason", value.substring(5));
					}
					// 人行填写内容只取第一条记录
					else if(i == 0) {
						// NPC处理状态
						if(value.startsWith("/F61/")){
							target.put("processStatus", value.substring(5));
						}
						// NPC轧差日期
						else if(value.startsWith("/C01/")){
							target.put("nettingDate", value.substring(5));
						}
						// NPC轧差场次
						else if(value.startsWith("/E05/")){
							target.put("nettingRound", value.substring(5));
						}
						// NPC清算日期/终态日期
						else if(value.startsWith("/C00/")){
							target.put("settlementDate", value.substring(5));
						}
					}
				}
			}
		}
	]]>
	</manual-mapping>
</message-bean-mapping>
