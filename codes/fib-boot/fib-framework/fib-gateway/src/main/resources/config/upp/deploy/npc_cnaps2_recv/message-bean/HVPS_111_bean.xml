<?xml version="1.0" encoding="UTF-8"?>
<message-bean message-charset="UTF-8" id="HVPS_111_bean" short-text="HVPS_111_bean" class="com.giantstone.cnaps2.messagebean.recv.req.HVPS_111_bean">

	<field name="MsgHeader" short-text="报文头" field-type="combine-field" reference="MsgHeader"/>
	<field name="DigitalSignature" short-text="数字签名" field-type="fixed-field" data-type="str" length="2048" prefix="{S:" suffix="0x7D0D0A" padding-direction="none"/>
	<field name="HVPS_111_Out" short-text="报文体" field-type="combine-field" reference="HVPS_111_Out"/>

	<field name="checkEscortFlag" short-text="核押验签结果" field-type="fixed-field" length="12" data-type="str"/>
	 
	 <event type="pre-parse"><![CDATA[
		messageParser.ignore("checkEscortFlag");
	]]></event>

<event type="post-parse">
<![CDATA[
		import com.giantstone.security.TccrbSignature;   //包名
		import com.giantstone.tcrcb.util.CommUtils;
		import com.giantstone.cnaps2.messagebean.recv.req.*;
		import java.util.List;
		import java.util.ArrayList;
		import com.uisftech.tcrcb.ext.StringBuffer;

		StringBuffer buf = new StringBuffer();


        String MessageIdentification = messageBean.HVPS_111_Out.MessageIdentification;
        String CreationDateTime = messageBean.HVPS_111_Out.CreationDateTime;
        String EndToEndIdentification = messageBean.HVPS_111_Out.EndToEndIdentification;

        String TransactionIdentification = messageBean.HVPS_111_Out.TransactionIdentification;
        String Proprietary = messageBean.HVPS_111_Out.Proprietary;
        String CurrencyType = messageBean.HVPS_111_Out.CurrencyType;
        String InterbankSettlementAmount = messageBean.HVPS_111_Out.InterbankSettlementAmount;

        buf.append(MessageIdentification);
		buf.append("|");
		buf.append(CreationDateTime);
		buf.append("|");
		buf.append(EndToEndIdentification);
		buf.append("|");
		buf.append(TransactionIdentification);
		buf.append("|");
		buf.append(Proprietary);
		buf.append("|");
		buf.append(CurrencyType);
		buf.append(InterbankSettlementAmount);
		buf.append("|");


 		String SettlementPriority = messageBean.HVPS_111_Out.SettlementPriority;
        String MemberIdentification = messageBean.HVPS_111_Out.MemberIdentification;
        String Identification = messageBean.HVPS_111_Out.Identification;
        String MemberIdentification2 = messageBean.HVPS_111_Out.MemberIdentification2;
        String Identification2 = messageBean.HVPS_111_Out.Identification2;
        String MemberIdentification3 = messageBean.HVPS_111_Out.MemberIdentification3;
        String Name = messageBean.HVPS_111_Out.Name;
        buf.append(SettlementPriority);
		buf.append("|");
		buf.append(MemberIdentification);
		buf.append("|");
		buf.append(Identification);
		buf.append("|");
		buf.append(MemberIdentification2);
		buf.append("|");
		buf.append(Identification2);
		buf.append("|");
		buf.append(MemberIdentification3);
		buf.append("|");
		buf.append(Name);
		buf.append("|");

		String MemberIdentification4 = messageBean.HVPS_111_Out.MemberIdentification4;
        String Name2 = messageBean.HVPS_111_Out.Name2;
        String Name3 = messageBean.HVPS_111_Out.Name3;
        buf.append(MemberIdentification4);
		buf.append("|");
		buf.append(Name2);
		buf.append("|");
		buf.append(Name3);
		buf.append("|");

		String AddressLine = messageBean.HVPS_111_Out.AddressLine;
        String Identification3 = messageBean.HVPS_111_Out.Identification3;
        String MemberIdentification5 = messageBean.HVPS_111_Out.MemberIdentification5;
        buf.append(AddressLine);
		buf.append("|");
		buf.append(Identification3);
		buf.append("|");
		buf.append(MemberIdentification5);
		buf.append("|");

		String Name4 = messageBean.HVPS_111_Out.Name4;
        String MemberIdentification6 = messageBean.HVPS_111_Out.MemberIdentification6;
        String Name5 = messageBean.HVPS_111_Out.Name5;
        buf.append(Name4);
		buf.append("|");
		buf.append(MemberIdentification6);
		buf.append("|");
		buf.append(Name5);
		buf.append("|");

		String Name6 = messageBean.HVPS_111_Out.Name6;
        String AddressLine2 = messageBean.HVPS_111_Out.AddressLine2;
        buf.append(Name6);
		buf.append("|");
		buf.append(AddressLine2);
		buf.append("|");

		String Identification4 = messageBean.HVPS_111_Out.Identification4;
        String Proprietary2 = messageBean.HVPS_111_Out.Proprietary2;
        buf.append(Identification4);
		buf.append("|");
		buf.append(Proprietary2);
		buf.append("|");

		//验签时list结构操作
		//List<String> tags=new ArrayList<String>();
		List tags = new ArrayList();
		tags.add("C03");
		tags.add("D15");
		tags.add("B18");
		tags.add("B15");
		tags.add("D16");
		tags.add("D17");
		tags.add("C0C");
		tags.add("F1A");
		tags.add("C0D");
		tags.add("D38");
		tags.add("D39");
		tags.add("D0M");
		tags.add("D0N");
		tags.add("D0O");
		tags.add("E51");
		tags.add("A70");
		tags.add("F40");
		tags.add("H20");
		tags.add("C14");
		tags.add("F56");
		tags.add("D63");
		tags.add("D64");
		tags.add("C17");
		tags.add("B21");
		tags.add("D30");
		tags.add("D0A");
		tags.add("E41");
		tags.add("C10");
		tags.add("E15");
		tags.add("F51");
		tags.add("B13");
		tags.add("A07");
		tags.add("D14");
		tags.add("A59");
		tags.add("B11");
		tags.add("B17");
		tags.add("D31");
		tags.add("A60");
		tags.add("B12");
		tags.add("B22");
		tags.add("D11");
		tags.add("C19");
		tags.add("F52");


		//方法原型CommUtils.appendTag(List addInfo, List<String> tags)

		List addInfo = messageBean.HVPS_111_Out.hvps;
		
		List infoList = new ArrayList();
			
		for(HVPS_111_OutHvps outHvps : addInfo){
			infoList.add(outHvps.ustrd);
		}

		String tagList = CommUtils.appendTag(infoList,tags);

		buf.append(tagList);
		buf.append("|");


	String digitalSig = messageBean.DigitalSignature;//签数据
	String oriSender = messageBean.MsgHeader.OrigSender;//发起人，分行号
	TccrbSignature s = new TccrbSignature ();  //工具类对象
	
	boolean verify2 = s.checkSign(buf.toString(),digitalSig,oriSender);
	if(!verify2){
		messageBean.setCheckEscortFlag("ErrorCheckEscort");
	}
	
]]>
</event>
</message-bean>